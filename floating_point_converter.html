<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>浮点数转换工具</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="floating_point_converter.css">
</head>

<body>
    <div class="container">
        <h1>浮点数转换工具</h1>

        <!-- 标签页 -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="standard">IEEE 754标准转换</button>
            <button class="tab-btn" data-tab="custom">自定义转换</button>
        </div>

        <!-- IEEE 754标准转换 -->
        <div id="standard" class="tab-content active">
            <div class="card standard-card">
                <div class="input-group">
                    <label for="decimal-input" class="tooltip">
                        请输入十进制小数
                        <span class="tooltiptext">支持正数、负数、科学计数法</span>
                    </label>

                    <!-- 输入框 -->
                    <input type="number" id="decimal-input" step="any" placeholder="例如：3.14159">
                </div>

                <!-- 按钮组 -->
                <div class="btn-group">
                    <button class="btn btn-primary" id="convert-standard">转换</button>
                    <button class="btn btn-secondary" onclick="clearInput()">清除</button>
                </div>

                <!-- 结果显示区域 -->
                <div class="result-section">
                    <div class="result-area" id="standard-result">
                        <button class="copy-btn" onclick="copyResult('standard-result')">复制</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 自定义转换 -->
        <div id="custom" class="tab-content">
            <div class="card custom-card">
                <div class="input-group">
                    <label for="custom-decimal" class="tooltip">
                        请输入十进制小数
                        <span class="tooltiptext">支持正数、负数、科学计数法</span>
                    </label>
                    <input type="number" id="custom-decimal" step="any" placeholder="例如：3.14159">
                </div>
                <div class="input-group">
                    <label for="exponent-type">阶码选项</label>
                    <select id="exponent-type">
                        <option value="excess">移码</option>
                        <option value="complement">补码</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="exponent-bits">阶码位数 (0-10)</label>
                    <input type="number" id="exponent-bits" min="0" max="10" placeholder="请输入阶码位数">
                    <div class="error" id="exponent-error"></div>
                </div>
                <div class="input-group">
                    <label for="mantissa-bits">尾数位数 (0-10)(补码表示)</label>
                    <input type="number" id="mantissa-bits" min="0" max="10" placeholder="请输入尾数位数">
                    <div class="error" id="mantissa-error"></div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="convert-custom">转换</button>
                    <button class="btn btn-secondary" onclick="clearInput()">清除</button>
                </div>
                <div class="result-section">
                    <div class="result-area" id="custom-result">
                        <button class="copy-btn" onclick="copyResult('custom-result')">复制</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加历史记录卡片 -->
        <div class="card history-card">
            <div class="history-section">
                <h3>历史记录</h3>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
    </div>

    <script src="floating_point_converter.js"></script>
    <script>
        // 覆盖历史记录显示函数
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            if (conversionHistory.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'history-item';
                emptyMessage.textContent = '暂无历史记录';
                historyList.appendChild(emptyMessage);
                return;
            }

            conversionHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                // 根据转换类型决定显示内容
                let resultDisplay = '';
                if (item.type === 'custom') {
                    // 对于自定义转换，只显示最后一行（完整二进制表示）
                    const lines = item.result.split('\n');
                    resultDisplay = lines[lines.length - 1];
                }
                
                div.innerHTML = `
                    <div><strong>${item.timestamp}</strong></div>
                    <div>类型: ${item.type === 'standard' ? 'IEEE 754标准转换' : '自定义转换'}</div>
                    <div>输入: ${item.input}</div>
                    ${resultDisplay ? `<div>结果: ${resultDisplay}</div>` : ''}
                    <div class="history-actions">
                        <button class="btn btn-secondary" onclick="copyHistoryItem(${index})">复制输入值</button>
                        <button class="btn btn-secondary" onclick="deleteHistoryItem(${index})">删除</button>
                    </div>
                `;
                historyList.appendChild(div);
            });
        }

        // 修改复制函数，只复制输入值
        function copyHistoryItem(index) {
            const item = conversionHistory[index];
            navigator.clipboard.writeText(item.input.toString()).then(() => {
                alert('输入值已复制到剪贴板');
            }).catch(err => {
                console.error('复制失败:', err);
            });
        }
    </script>
</body>

</html>